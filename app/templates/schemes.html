{% extends "base.html" %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="container">
    <div class="card">
        <div class="card-header">
            <h1 class="card-title">ЁЯПЫя╕П рд╕рд░рдХрд╛рд░реА рдпреЛрдЬрдирд╛рдПрдВ</h1>
            <div class="schemes-summary">
                <span class="schemes-count">{{ schemes|length }} рдпреЛрдЬрдирд╛рдПрдВ рдЙрдкрд▓рдмреНрдз</span>
            </div>
        </div>

        <!-- Quick Eligibility Check -->
        <div class="eligibility-checker">
            <h3>ЁЯФН рддреБрд░рдВрдд рдкрд╛рддреНрд░рддрд╛ рдЬрд╛рдВрдЪреЗрдВ</h3>
            <div class="eligibility-form">
                <div class="form-row">
                    <div class="form-group">
                        <label>рдЖрдкрдХреА рднреВрдорд┐ (рд╣реЗрдХреНрдЯреЗрдпрд░ рдореЗрдВ):</label>
                        <input type="number" id="landSize" placeholder="2">
                    </div>
                    <div class="form-group">
                        <label>рд╡рд╛рд░реНрд╖рд┐рдХ рдЖрдп:</label>
                        <select id="annualIncome">
                            <option value="below-2lakh">тВ╣2 рд▓рд╛рдЦ рд╕реЗ рдХрдо</option>
                            <option value="2-5lakh">тВ╣2-5 рд▓рд╛рдЦ</option>
                            <option value="above-5lakh">тВ╣5 рд▓рд╛рдЦ рд╕реЗ рдЕрдзрд┐рдХ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>рдХрд┐рд╕рд╛рди рдХрд╛ рдкреНрд░рдХрд╛рд░:</label>
                        <select id="farmerType">
                            <option value="small">рдЫреЛрдЯрд╛ рдХрд┐рд╕рд╛рди</option>
                            <option value="marginal">рд╕реАрдорд╛рдВрдд рдХрд┐рд╕рд╛рди</option>
                            <option value="large">рдмрдбрд╝рд╛ рдХрд┐рд╕рд╛рди</option>
                        </select>
                    </div>
                </div>
                <button class="btn-primary" onclick="checkEligibility()">рдкрд╛рддреНрд░рддрд╛ рдЬрд╛рдВрдЪреЗрдВ</button>
            </div>
            <div class="eligibility-results" id="eligibilityResults" style="display: none;">
                <h4>рдЖрдкрдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рдпреЛрдЬрдирд╛рдПрдВ:</h4>
                <div id="eligibleSchemes"></div>
            </div>
        </div>

        <div class="scheme-grid">
            {% for scheme in schemes %}
            <div class="scheme-card" data-scheme="{{ scheme.scheme_name }}">
                <div class="scheme-header">
                    <div class="scheme-icon">ЁЯТ░</div>
                    <div class="scheme-title">{{ scheme.scheme_name }}</div>
                </div>
                <div class="scheme-amount">{{ scheme.amount }}</div>
                <div class="scheme-description">{{ scheme.description }}</div>

                <div class="scheme-details">
                    <h4>рдореБрдЦреНрдп рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ:</h4>
                    <ul class="scheme-features">
                        {% for feature in scheme.features %}
                        <li>{{ feature }}</li>
                        {% endfor %}
                    </ul>

                    <h4>рдкрд╛рддреНрд░рддрд╛ рд╢рд░реНрддреЗрдВ:</h4>
                    <ul class="scheme-eligibility">
                        {% for criteria in scheme.eligibility %}
                        <li>{{ criteria }}</li>
                        {% endfor %}
                    </ul>
                </div>

                <div class="scheme-actions">
                    <button class="btn-primary" onclick="applyScheme('{{ scheme.scheme_name }}')">
                        ЁЯУЭ рдЖрд╡реЗрджрди рдХрд░реЗрдВ
                    </button>
                    <button class="btn-secondary" onclick="getSchemeDetails('{{ scheme.scheme_name }}')">
                        тД╣я╕П рдФрд░ рдЬрд╛рдиреЗрдВ
                    </button>
                </div>

                <div class="scheme-status">
                    <div class="status-item">
                        <span class="status-label">рдЖрд╡реЗрджрди рдХреА рд╕реНрдерд┐рддрд┐:</span>
                        <span class="status-value online">рдСрдирд▓рд╛рдЗрди</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдЯрд╛рдЗрдо:</span>
                        <span class="status-value">15-30 рджрд┐рди</span>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Additional Schemes Section -->
        <div class="additional-schemes">
            <h2>ЁЯМЯ рдЕрдиреНрдп рдорд╣рддреНрд╡рдкреВрд░реНрдг рдпреЛрдЬрдирд╛рдПрдВ</h2>
            <div class="additional-scheme-grid">
                <div class="additional-scheme-card">
                    <div class="scheme-icon">ЁЯЪЬ</div>
                    <h3>рдХреГрд╖рд┐ рдпрдВрддреНрд░ рд╕рдмреНрд╕рд┐рдбреА</h3>
                    <p>40-50% рд╕рдмреНрд╕рд┐рдбреА рдкрд░ рдЯреНрд░реИрдХреНрдЯрд░ рдФрд░ рдЕрдиреНрдп рдХреГрд╖рд┐ рдЙрдкрдХрд░рдг</p>
                    <button class="btn-outline" onclick="applyScheme('machinery')">рдЖрд╡реЗрджрди рдХрд░реЗрдВ</button>
                </div>

                <div class="additional-scheme-card">
                    <div class="scheme-icon">ЁЯТз</div>
                    <h3>PM рдХреГрд╖рд┐ рд╕рд┐рдВрдЪрд╛рдИ рдпреЛрдЬрдирд╛</h3>
                    <p>75% рд╕рдмреНрд╕рд┐рдбреА рдкрд░ рдбреНрд░рд┐рдк рдФрд░ рд╕реНрдкреНрд░рд┐рдВрдХрд▓рд░ рд╕рд┐рд╕реНрдЯрдо</p>
                    <button class="btn-outline" onclick="applyScheme('irrigation')">рдЖрд╡реЗрджрди рдХрд░реЗрдВ</button>
                </div>

                <div class="additional-scheme-card">
                    <div class="scheme-icon">ЁЯМ▒</div>
                    <h3>PM рдХреБрд╕реБрдо рдпреЛрдЬрдирд╛</h3>
                    <p>90% рд╕рдмреНрд╕рд┐рдбреА рдкрд░ рд╕реЛрд▓рд░ рдкрдВрдк рдФрд░ рд╕реЛрд▓рд░ рдкрд╛рд╡рд░ рдкреНрд▓рд╛рдВрдЯ</p>
                    <button class="btn-outline" onclick="applyScheme('kusum')">рдЖрд╡реЗрджрди рдХрд░реЗрдВ</button>
                </div>

                <div class="additional-scheme-card">
                    <div class="scheme-icon">ЁЯПж</div>
                    <h3>рдХрд┐рд╕рд╛рди рдорд╛рдирдзрди рдпреЛрдЬрдирд╛</h3>
                    <p>тВ╣3000 рдорд╛рд╕рд┐рдХ рдкреЗрдВрд╢рди 60 рд╡рд░реНрд╖ рдХреА рдЖрдпреБ рдХреЗ рдмрд╛рдж</p>
                    <button class="btn-outline" onclick="applyScheme('pension')">рдЖрд╡реЗрджрди рдХрд░реЗрдВ</button>
                </div>
            </div>
        </div>

        <!-- Application Tracking -->
        <div class="application-tracking">
            <h2>ЁЯУЛ рдЖрд╡реЗрджрди рдЯреНрд░реИрдХрд┐рдВрдЧ</h2>
            <div class="tracking-form">
                <input type="text" id="applicationId" placeholder="рдЖрд╡реЗрджрди рд╕рдВрдЦреНрдпрд╛ рдбрд╛рд▓реЗрдВ">
                <button class="btn-primary" onclick="trackApplication()">рд╕реНрдерд┐рддрд┐ рджреЗрдЦреЗрдВ</button>
            </div>
            <div class="tracking-results" id="trackingResults" style="display: none;">
                <!-- Results will be populated here -->
            </div>
        </div>

        <!-- Help & Support -->
        <div class="help-support">
            <h2>тЭУ рд╕рд╣рд╛рдпрддрд╛ рдФрд░ рд╕рдорд░реНрдерди</h2>
            <div class="support-options">
                <div class="support-card">
                    <div class="support-icon">ЁЯУЮ</div>
                    <h3>рд╣реЗрд▓реНрдкрд▓рд╛рдЗрди</h3>
                    <p>рдХрд┐рд╕рд╛рди рдХреЙрд▓ рд╕реЗрдВрдЯрд░: <strong>1800-180-1551</strong></p>
                    <p>рд╕рдордп: рд╕реБрдмрд╣ 6 рдмрдЬреЗ рд╕реЗ рд░рд╛рдд 10 рдмрдЬреЗ рддрдХ</p>
                </div>

                <div class="support-card">
                    <div class="support-icon">ЁЯМР</div>
                    <h3>рдСрдирд▓рд╛рдЗрди рдкреЛрд░реНрдЯрд▓</h3>
                    <p>PM-KISAN: pmkisan.gov.in</p>
                    <p>рдХреГрд╖рд┐ рдордВрддреНрд░рд╛рд▓рдп: agriculture.gov.in</p>
                </div>

                <div class="support-card">
                    <div class="support-icon">ЁЯУз</div>
                    <h3>рдИрдореЗрд▓ рд╕рдкреЛрд░реНрдЯ</h3>
                    <p>pmkisan-ict@gov.in</p>
                    <p>24-48 рдШрдВрдЯреЗ рдореЗрдВ рдЬрд╡рд╛рдм</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function checkEligibility() {
    const landSize = document.getElementById('landSize').value;
    const income = document.getElementById('annualIncome').value;
    const farmerType = document.getElementById('farmerType').value;

    if (!landSize) {
        showNotification('рдХреГрдкрдпрд╛ рднреВрдорд┐ рдХрд╛ рдЖрдХрд╛рд░ рдбрд╛рд▓реЗрдВ', 'warning');
        return;
    }

    // Simple eligibility logic
    const eligibleSchemes = [];

    if (parseFloat(landSize) <= 2) {
        eligibleSchemes.push('PM-KISAN рдпреЛрдЬрдирд╛');
        eligibleSchemes.push('рдкреНрд░рдзрд╛рдирдордВрддреНрд░реА рдлрд╕рд▓ рдмреАрдорд╛ рдпреЛрдЬрдирд╛');
    }

    if (income === 'below-2lakh') {
        eligibleSchemes.push('рдХрд┐рд╕рд╛рди рдХреНрд░реЗрдбрд┐рдЯ рдХрд╛рд░реНрдб');
        eligibleSchemes.push('рдХреГрд╖рд┐ рдпрдВрддреНрд░ рд╕рдмреНрд╕рд┐рдбреА');
    }

    displayEligibilityResults(eligibleSchemes);
}

function displayEligibilityResults(schemes) {
    const resultsDiv = document.getElementById('eligibilityResults');
    const schemesDiv = document.getElementById('eligibleSchemes');

    if (schemes.length === 0) {
        schemesDiv.innerHTML = '<p class="no-schemes">рдХреЛрдИ рдпреЛрдЬрдирд╛ рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИред рдХреГрдкрдпрд╛ рдЕрдкрдиреА рдЬрд╛рдирдХрд╛рд░реА рджреЛрдмрд╛рд░рд╛ рдЬрд╛рдВрдЪреЗрдВред</p>';
    } else {
        schemesDiv.innerHTML = schemes.map(scheme =>
            `<div class="eligible-scheme">тЬЕ ${scheme}</div>`
        ).join('');
    }

    resultsDiv.style.display = 'block';
}

function applyScheme(schemeName) {
    // In production, this would redirect to actual application portal
    showNotification(`${schemeName} рдХреЗ рд▓рд┐рдП рдЖрд╡реЗрджрди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╢реБрд░реВ рдХреА рдЧрдИ`, 'success');

    // Simulate opening application form
    setTimeout(() => {
        const applicationId = 'APP' + Date.now().toString().slice(-8);
        showNotification(`рдЖрд╡реЗрджрди рд╕рдВрдЦреНрдпрд╛: ${applicationId}`, 'info');
    }, 2000);
}

function getSchemeDetails(schemeName) {
    // Show detailed information modal or redirect
    fetch(`/api/scheme-details/${encodeURIComponent(schemeName)}`)
        .then(response => response.json())
        .then(data => {
            showSchemeDetailsModal(data);
        })
        .catch(error => {
            showNotification('рдпреЛрдЬрдирд╛ рдХреА рдЬрд╛рдирдХрд╛рд░реА рд▓реЛрдб рдХрд░рдиреЗ рдореЗрдВ рд╕рдорд╕реНрдпрд╛', 'error');
        });
}

function trackApplication() {
    const applicationId = document.getElementById('applicationId').value;

    if (!applicationId) {
        showNotification('рдХреГрдкрдпрд╛ рдЖрд╡реЗрджрди рд╕рдВрдЦреНрдпрд╛ рдбрд╛рд▓реЗрдВ', 'warning');
        return;
    }

    // Mock tracking result
    const trackingResults = document.getElementById('trackingResults');
    trackingResults.innerHTML = `
        <div class="tracking-result">
            <h4>рдЖрд╡реЗрджрди рд╕рдВрдЦреНрдпрд╛: ${applicationId}</h4>
            <div class="status-timeline">
                <div class="status-step completed">
                    <div class="step-icon">тЬЕ</div>
                    <div class="step-content">
                        <div class="step-title">рдЖрд╡реЗрджрди рдкреНрд░рд╛рдкреНрдд</div>
                        <div class="step-date">15/01/2024</div>
                    </div>
                </div>
                <div class="status-step completed">
                    <div class="step-icon">тЬЕ</div>
                    <div class="step-content">
                        <div class="step-title">рджрд╕реНрддрд╛рд╡реЗрдЬ рд╕рддреНрдпрд╛рдкрди</div>
                        <div class="step-date">18/01/2024</div>
                    </div>
                </div>
                <div class="status-step active">
                    <div class="step-icon">тП│</div>
                    <div class="step-content">
                        <div class="step-title">рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг</div>
                        <div class="step-date">рдЪрд▓ рд░рд╣рд╛ рд╣реИ</div>
                    </div>
                </div>
                <div class="status-step pending">
                    <div class="step-icon">тнХ</div>
                    <div class="step-content">
                        <div class="step-title">рдЕрдиреБрдореЛрджрди</div>
                        <div class="step-date">рд▓рдВрдмрд┐рдд</div>
                    </div>
                </div>
            </div>
        </div>
    `;
    trackingResults.style.display = 'block';
}

function showSchemeDetailsModal(data) {
    // Implementation for showing detailed scheme information
    // This would typically open a modal with comprehensive details
    alert(`${data.name} рдХреА рд╡рд┐рд╕реНрддреГрдд рдЬрд╛рдирдХрд╛рд░реА рдпрд╣рд╛рдБ рджрд┐рдЦрд╛рдИ рдЬрд╛рдПрдЧреА`);
}
</script>
{% endblock %}